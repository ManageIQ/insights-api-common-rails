QueryType = ::GraphQL::ObjectType.define do
  name "Query"
  description "The query root of this schema"

  [
    <%= collections.map { |c| ":#{c}" }.join(", ") %>
  ].each do |collection|

    klass_names   = collection.to_s.camelize
    klass_name    = klass_names.singularize
    model_class   = klass_name.constantize
    resource_type = "Api::#{version_namespace}::GraphQL::#{klass_name}Type".constantize

    field collection do
      description "List available #{collection}"
      type types[resource_type]

      argument :id, types.ID
      argument :offset, types.Int, "The number of #{collection} to skip before starting to collect the result set"
      argument :limit,  types.Int, "The number of #{collection} to return"
      argument :filter, ::ManageIQ::API::Common::GraphQL::Types::QueryFilter, "The Query Filter for querying the #{collection}"

      resolve lambda { |_obj, args, _ctx|
        scope = if args[:filter]
                  ::ManageIQ::API::Common::Filter.new(model_class,
                                                      ActionController::Parameters.new(args[:filter]),
                                                      ::ManageIQ::API::Common::OpenApi::Docs.instance["<%= api_version %>"].definitions[klass_name]).apply
                else
                  model_class
                end
        ::ManageIQ::API::Common::GraphQL.paginated_search(scope, args)
      }
    end
  end
end
